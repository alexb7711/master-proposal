* APPROACH
:PROPERTIES:
:CUSTOM_ID: sec:approach
:END:

** Mathematically model the PAP to optimally assign BEBs to queues with unknown charging times to allow consideration of consumption cost and battery health
:PROPERTIES:
:CUSTOM_ID: sec:math-model-pap
:END:

This section introduces the actions and formulations associated with the objective described in [[#sec:objectives]]. This
section addresses the actions by deriving a method of identifying buses for subsequent visits, utilizing that to
formulate a way of estimating the SOC during the BEBs charging phase. The method introduced in this section demonstrates
the linear battery dynamics that have been implemented in the MILP-PAP. Non-linear dynamics will then be introduced with
a brief description of the mathematical approach that will be taken. The derivation also demonstrates how the model will
discretize the queuing space to accommodate chargers of multiple varieties.

*** The PAP Formulation
:PROPERTIES:
:CUSTOM_ID: sec:the-pap-formulation
:CUSTOM_ID: sec:input-variables
:END:

#+include: "../sup-doc/milp-pap-paper-frontiers/sections/pap-problem.org::#sec:the-pap-formulation" :only-contents t
#+include: "../sup-doc/milp-pap-paper-frontiers/sections/vartab.org" :only-contents t

*** A Rectangle Packing Formulation for BEB Charging
:PROPERTIES:
:CUSTOM_ID: sec:problemformulation
:END:

#+include: "../sup-doc/milp-pap-paper-frontiers/sections/rectangle-packing.org::#sec:problemformulation" :only-contents t

*** Non-Linear Battery Dynamics
:PROPERTIES:
:CUSTOM_ID: sec:non-linear-battery-dynamics
:END:

Modeling the charging dynamics is imperative to the model's accuracy as it is one of the main factors in terms of the
decision variables. If the SOC is improperly modeled, that will produce an erroneous depiction of the state of BEB
charges and could result in over charging or worse, undercharging. Thus, care must be taken into considering the BEB's
charging model. There are various methods of modeling the SOC of a battery an can vary in complexity based on the
attempt to incorporate temperature, battery degradation, and current
[cite:@zhang-2021-optim-elect;@chen-2008-desig-grey;@watrin-2012-multip-lithium].

Some of the conventional methods to charge batteries are: Constant Voltage (CV), Constant Current (CC), Constant Power
(CP), and Constant Current Voltage (CCCV) [cite:@arabsalmanabadi-2018-charg-techn]. CCCV, as the name describes, is the
combination of CCCV model [cite:@abdollahi-2016-optim-batter; @chen-2008-desig-grey; @wang-2021-resear-optim]. In CCCV,
a constant current is applied to a battery until it reaches terminal voltage. At this point a constant voltage is
applied as the charge current decreases and the battery reaches full charge [cite:@chen-2008-desig-grey].

As previously stated, the SOC can be accurately modeled until the battery reaches a charge of about 80%
[cite:@liu-2020-batter-elect]. At this point the SOC becomes non-linear. As previously discussed,
[cite:@zhang-2021-optim-elect] suggests that the SOC can be broken down into a linear and non-linear component. A plot
of SOC of a battery is shown in [[fig:soc-plot]] to demonstrate these components [cite:@zhang-2021-optim-elect].

#+name: fig:soc-plot
#+caption: Illistration of non-linear charging profile.
[[file:../img/soc-plot.png]]

While some leverage the linear and non-linear components to derive their SOC model [cite:@abdollahi-2016-optim-batter],
others have derived a first order equation to model this behavior [cite:@whitaker-2023-a-network]. Assume that a charge
will occur over $dt$ seconds. The SOC on the time step $h+1$ for bus $i$ can be determined by the simple discrete first
order equation

#+begin_export latex
\begin{equation}
  \eta_{\xi_i} = \bar{a}_q \eta_i - \bar{b}_q \kappa_{\Xi_i}
\end{equation}
#+end_export

where

#+begin_export latex
\begin{equation}
\begin{array}{cc}
  \bar{a}_q = e^{a_q dt} & \bar{b}_q = e^{a_q dt} - 1
\end{array}
\end{equation}
#+end_export

The equation is developed by using exact discretization [cite:@hespanha-2018-linear], and is proved in
[cite:@whitaker-2023-a-network]. In the same way as the linear dynamics, the $i^{\text{th}}$ visit's initial charge is
indicated by $\eta_i$, the identity of visit $i$ is $\eta_{\Xi_i}$, and the subsequent visit is indicated by $\eta_{\xi_i}$. Thus,
the propagation mechanics remain untouched while the underlying battery dynamics are more accurate.

** Develop robust charger allocation capabilities to account for BEB arrival time uncertainties and non-linear battery dynamics
:PROPERTIES:
:CUSTOM_ID: sec:math-model-robust
:END:

In this section, the actions for the objective of providing a robust solution are discussed. The actions will be
completed by introducing and formulating a Fully Fuzzy Mixed Linear Integer Program (FFMILP). The basics of fuzzy set
theory is introduced as well as an introductory discussion of Fully Fuzzy Linear Programming (FFLP). A model for the
Fuzzy BAP is derived and then interpreted into the Fuzzy PAP.

#+begin_comment
The method of implementing the penalty function will be
described early on in [[#sec:minimize-monetary-cost]] as it is a part of the objective function. While logically, the action
fits within the current objective, the discussion of the mathematics is more coherent if discussed together.
#+end_comment

*** The Fuzzy PAP
:PROPERTIES:
:CUSTOM_ID: sec:the-fuzzy-pap
:END:

#+include: "../sup-doc/fuzzy-lp-paper/sections/the-fuzzy-pap.org::#sec:the-fuzzy-pap" :only-contents t

The penalty function, introduced under [[#sec:obj-math-model-robust]], logically fits under the objective to provide a more
robust solution as its intent is to widen the solution space; however, the mathematics to develop the penalty method is
introduced in the objective function in the same way as the consumption and demand costs. The actions taken to develop
the penalty function will therefore be presented in tandem with the consumption and demand costs next.

** Minimize the monetary cost of charging the BEBs
:PROPERTIES:
:CUSTOM_ID: sec:minimize-monetary-cost
:END:

This section discusses the actions associated with the objective to minimize the monetary cost of charging the BEBs. To
accomplish the task, an objective function is incrementally developed to introduce the components of the assignment and
power costs. The assignment cost encodes the minimization of the chargers and encouraged use of slow chargers, as
discussed in [[#sec:math-model-pap]]. The assignment cost also introduces the penalty function, for the objective in
[[#sec:obj-math-model-robust]], in an attempt to broaden the solution space of the MILP. The power cost component
encompasses the consumption and demand costs which will be derived. The method of more aggressively reducing demand cost
for peak hours is also introduced with the power cost component.

*** Objective Function
:PROPERTIES:
:CUSTOM_ID: sec:objective-function
:END:

#+include: "../sup-doc/sa-pap-paper/sections/optimization-problem.org::#sec:objective-function" :only-contents t

*** Constraints
:PROPERTIES:
:CUSTOM_ID: sec:constraints
:END:

#+include: "../sup-doc/sa-pap-paper/sections/optimization-problem.org::#sec:constraints" :only-contents t

** Method And Validation :noexport:
The proposed work is to be modeled and simulated using a SA approach written in the Rust programming language. Rust has
been chosen for its reliability with its ownership model, performance that is comparable to C/C++, and its Python-like
packaging system. SA was chosen as for its simplicity in implementation, and is one of the best known metaheuristic
methods for "addressing difficult black global optimization problems" [cite:@delahaye-2019-simul]. Note that the SA-PAP
implementation has begun. At the moment the main development that has been completed is: project structure/design,
implementation of the skeletal framework, code for importing route data, and some work has been done on the generating
functions. As previously stated, the MILP-PAP has been implemented and tested. Thus, the MILP-PAP shall be used as a
baseline measure to compare the results of the proposed work. An introduction to Simulated Annealing as well as the
proposed method of implementation will subsequently be outlined and discussed.

*** Simulated Annealing
:PROPERTIES:
:CUSTOM_ID: sec:simulated-annealing
:END:

#+include: "../sup-doc/sa-pap-paper/sections/simulated-annealing.org::#sec:simulated-annealing" :only-contents t

*** Optimization Algorithm
:PROPERTIES:
:CUSTOM_ID: sec:optimization-algorithm
:END:

#+include: "../sup-doc/sa-pap-paper/sections/optimization-algorithm.org::#optimization-algorithm" :only-contents t

** Project Schedule :noexport:
The following Gantt chart, shown in \autoref{fig:gantt}, plots out the work that has been completed and the work to be completed.
The estimated completion date is early to mid-November. Note that the blocks before the =TODAY= mark in
\autoref{fig:gantt} is work that has been previously completed or is work in progress.

#+begin_src latex
  \begin{figure}
    \begin{ganttchart}[
      vgrid={*{11}{gray, dotted}, *1{black, dashed}},
      bar label node/.append style={
        align=left,
        text width=width("Aim 2. Software verificationx")},
      today=20
      ]{1}{24}
      \gantttitle{2022}{12} \gantttitle{2023}{12} \\
      \gantttitlelist{1,...,24}{1} \\
      \ganttbar{MILP-PAP}{1}{12} \\
      \ganttbar{SA-PAP}{9}{21} \\
      \ganttbar{Non-Linear Battery Dynamics}{20}{21} \\
      \ganttbar{Fuzzy PAP}{18}{23} \\
      \ganttbar{Defense}{23}{24} \\
    \end{ganttchart}
    \caption{Gantt chart for the proposed work.}
    \label{fig:gantt}
  \end{figure}
#+end_src

** Summary
:PROPERTIES:
:CUSTOM_ID: sec:approach-summary
:END:

The previous sections have addressed Objectives one through three by describing the approaches to be taken (or have
taken) for each respective objective along with a derivation when available for the proposed approach. This research
intends to increase utility of the PAP by first modifying the model to allow BEBs' charges to be propagated, include an
identifier for BEBs to be tracked, utilize non-linear charging dynamics, as well as utilizing FFLP to develop a robust
solution. This framework is intended to be implemented using a SA for its ease of implementation along with flexibility
the numerical solver contains. Upon completion, the proposed research will demonstrate its full utility and
extensibility due to the MILP's nature of adding additional constraints. This research project shall illustrate a robust
BEB charging schedule with realistic applicability.
